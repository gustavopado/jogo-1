<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jogo de Carro 3D</title>
<style>
body {margin:0; overflow:hidden; background:#222; color:#eee; font-family:Arial,sans-serif;}
#info {position:absolute; top:10px; width:100%; text-align:center; font-size:1.5em; color:#0f0;}
#endGameMessage {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
 background:rgba(0,0,0,0.8); padding:30px; border-radius:10px; text-align:center; color:white; display:none;}
#restartButton,#hornButton {margin-top:20px; padding:10px 20px; font-size:1.2em; font-weight:bold; color:white;
 background:#007bff; border:none; border-radius:5px; cursor:pointer; transition:0.3s;}
#restartButton:hover,#hornButton:hover {background:#0056b3;}
#hornButton {position:absolute; bottom:20px; right:20px; z-index:15;}
canvas {display:block;}
</style>
</head>
<body>
<div id="info">PontuaÃ§Ã£o: <span id="score">0</span></div>
<div id="endGameMessage">
<h2>Fim de Jogo!</h2>
<p>Sua pontuaÃ§Ã£o: <span id="finalScore">0</span></p>
<button id="restartButton">Reiniciar Jogo</button>
</div>
<button id="hornButton">ðŸš— Buzinar</button>
<audio id="hornSound" src="buzina.mp3" preload="auto"></audio>
<audio id="engineSound" src="motor.mp3" preload="auto" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
//=== SETUP ===
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,15,30); camera.lookAt(0,0,0);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);
const ambientLight=new THREE.AmbientLight(0xffffff,0.7);
scene.add(ambientLight);
const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);
directionalLight.position.set(10,20,10);
scene.add(directionalLight);

//=== ROAD ===
const road=new THREE.Mesh(new THREE.PlaneGeometry(20,200), new THREE.MeshStandardMaterial({color:0x333333}));
road.rotation.x=-Math.PI/2; road.position.z=-10; scene.add(road);

//=== LINES ===
const lineMat=new THREE.MeshStandardMaterial({color:0xffff00});
const lines=[]; for(let i=0;i<20;i++){const line=new THREE.Mesh(new THREE.BoxGeometry(1,0.05,9),lineMat);
line.position.set(0,0.01,i*1-10); scene.add(line); lines.push(line);}

//=== CARRO ===
function createCar(color){
 const car=new THREE.Group();
 const base=new THREE.Mesh(new THREE.BoxGeometry(3,1,5),new THREE.MeshStandardMaterial({color}));
 base.position.y=0.5; car.add(base);
 const hood=new THREE.Mesh(new THREE.BoxGeometry(3,0.7,2),new THREE.MeshStandardMaterial({color:0x222222}));
 hood.position.set(0,1.0,1.5); car.add(hood);
 const roof=new THREE.Mesh(new THREE.BoxGeometry(2,0.5,3),new THREE.MeshStandardMaterial({color:0x555555}));
 roof.position.set(0,1.3,-0.3); car.add(roof);
 const wheelGeo=new THREE.CylinderGeometry(0.5,0.5,0.3,16);
 const wheelMat=new THREE.MeshStandardMaterial({color:0x222222});
 for(let i=-1;i<=1;i+=2){for(let j=-1;j<=1;j+=2){
 const wheel=new THREE.Mesh(wheelGeo,wheelMat); wheel.rotation.z=Math.PI/2; wheel.position.set(i*1.2,0.3,j*1.8); car.add(wheel);}}
 return car;
}

const playerCar=createCar(0x0000ff); playerCar.position.z=20; scene.add(playerCar);
const enemies=[]; const trees=[];

//=== TREES ===
function createTree(){const tree=new THREE.Group();
const trunk=new THREE.Mesh(new THREE.CylinderGeometry(0.3,0.3,2),new THREE.MeshStandardMaterial({color:0x8B4513})); trunk.position.y=1; tree.add(trunk);
const leaves=new THREE.Mesh(new THREE.ConeGeometry(1.5,4,8),new THREE.MeshStandardMaterial({color:0x228B22})); leaves.position.y=3.5; tree.add(leaves);
return tree;}
for(let i=0;i<10;i++){
 let treeL=createTree(); treeL.position.set(-12,0,i*10-50); scene.add(treeL); trees.push(treeL);
 let treeR=createTree(); treeR.position.set(12,0,i*10-50); scene.add(treeR); trees.push(treeR);
}

//=== GAME VARIABLES ===
let score=0; let gameOver=false; const speed=0.5; const laneWidth=7; const maxX=laneWidth; const keys={};
window.addEventListener('keydown',e=>keys[e.key]=true); window.addEventListener('keyup',e=>keys[e.key]=false);

//=== SPAWN INIMIGOS ===
function spawnEnemy(){if(gameOver) return;
 const enemy=createCar(0xff0000); enemy.position.z=-50;
 const lanes=[-laneWidth,0,laneWidth]; enemy.position.x=lanes[Math.floor(Math.random()*lanes.length)];
 scene.add(enemy); enemies.push(enemy);}
spawnEnemy(); let spawnInterval=setInterval(spawnEnemy,1500);

//=== UPDATE ===
function updateRoadLines(){lines.forEach(line=>{line.position.z+=speed*10;if(line.position.z>30) line.position.z=-70;});}
function updateTrees(){trees.forEach(tree=>{tree.position.z+=speed;if(tree.position.z>20) tree.position.z-=120;});}
function checkCollision(a,b){return new THREE.Box3().setFromObject(a).intersectsBox(new THREE.Box3().setFromObject(b));}

//=== AUDIO ===
const engineSound=document.getElementById("engineSound");
function playEngine(){if(engineSound.paused){engineSound.volume=0.4; engineSound.play().catch(()=>{});}}
function stopEngine(){if(!engineSound.paused){engineSound.pause(); engineSound.currentTime=0;}}

//=== SCORE ===
const scoreDisplay=document.getElementById('score');
const endGameMessage=document.getElementById('endGameMessage');
const finalScoreDisplay=document.getElementById('finalScore');
const restartButton=document.getElementById('restartButton');
restartButton.addEventListener('click',()=>{
 gameOver=false; score=0; scoreDisplay.textContent=score; playerCar.position.x=0;
 enemies.forEach(e=>scene.remove(e)); enemies.length=0;
 endGameMessage.style.display='none'; spawnInterval=setInterval(spawnEnemy,1500); animate();
});

//=== BUZINA ===
function playHorn(){const horn=document.getElementById("hornSound"); horn.currentTime=0; horn.play();}
document.getElementById("hornButton").addEventListener("click",playHorn);
window.addEventListener("keydown",e=>{if(e.key.toLowerCase()==='b') playHorn();});

//=== ANIMATE ===
function animate(){
 if(gameOver){stopEngine(); return;}
 requestAnimationFrame(animate);
 // Movimento carro
 let moving=false;
 if(keys['ArrowLeft'] && playerCar.position.x>-maxX){playerCar.position.x-=0.3; moving=true;}
 if(keys['ArrowRight'] && playerCar.position.x<maxX){playerCar.position.x+=0.3; moving=true;}
 if(moving){playEngine();} else {playEngine();}
 // Inimigos
 for(let i=enemies.length-1;i>=0;i--){
  const e=enemies[i]; e.position.z+=speed;
  if(e.position.z>30){scene.remove(e); enemies.splice(i,1); score++; scoreDisplay.textContent=score;}
  if(checkCollision(playerCar,e)){gameOver=true; finalScoreDisplay.textContent=score; endGameMessage.style.display='block'; clearInterval(spawnInterval);}
 }
 updateRoadLines(); updateTrees();
 renderer.render(scene,camera);
}

animate();
window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth,window.innerHeight);});
</script>
</body>
</html>
